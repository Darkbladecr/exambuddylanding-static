function receiveSettings(t){if(t.origin===location.origin)return receiveInternalData(t);if(t.origin!==checkProtocol(trustpilot_integration_settings.TRUSTPILOT_INTEGRATION_APP_URL))return;const e=t.data;if("string"==typeof e)if(e.startsWith("sync:")||e.startsWith("showPastOrdersInitial:")){const t=e.split(":"),n={action:"handle_past_orders"};n[t[0]]=t[1],this.submitPastOrdersCommand(n)}else if(e.startsWith("resync")){const t={action:"handle_past_orders",resync:"resync"};this.submitPastOrdersCommand(t)}else if(e.startsWith("issynced")){const t={action:"handle_past_orders",issynced:"issynced"};this.submitPastOrdersCommand(t)}else if(e.startsWith("check_product_skus")){const t=e.split(":"),n={action:"check_product_skus"};n.skuSelector=t[1],this.submitCheckProductSkusCommand(n)}else"signup_data"===e?this.sendSignupData():"update"===e?updateplugin():"reload"===e?reloadSettings():e&&tryParseJson(e)&&JSON.parse(e).TrustBoxPreviewMode?TrustBoxPreviewMode(e):handleJSONMessage(e)}function receiveInternalData(t){const e=t.data;if(e&&"string"==typeof e&&tryParseJson(e)){const t=JSON.parse(e);t&&"updatePageUrls"===t.type&&submitSettings(t),t&&"loadCategoryProductInfo"===t.type&&requestCategoryInfo(),t&&"newTrustBox"===t.type&&submitSettings(t)}}function handleJSONMessage(t){if(tryParseJson(t)){const e=JSON.parse(t);if(e.window)this.updateIframeSize(e);else if("submit"===e.type)this.submitSettings(e);else if(e.trustbox){document.getElementById("trustbox_preview_frame").contentWindow.postMessage(JSON.stringify(e.trustbox),"*")}}}function encodeSettings(t){let e="";for(const n in t)e+=`${n}=${t[n]}&`;return e.substring(0,e.length-1)}function getFormValues(t){let e={};for(const n in t.elements){const s=t.elements[n];"INPUT"===s.nodeName&&(e[s.name]=s.value)}return e}function tryParseJson(t){try{JSON.parse(t)}catch(t){return!1}return!0}function submitPastOrdersCommand(t){const e=new XMLHttpRequest;e.open("POST",ajaxurl,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4===e.readyState&&(e.status>=400?console.log(`callback error: ${e.response} ${e.status}`):sendPastOrdersInfo(e.response))},e.send(encodeSettings(t))}function submitCheckProductSkusCommand(t){const e=new XMLHttpRequest;e.open("POST",ajaxurl),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){if(4===e.readyState)if(e.status>=400)console.log(`callback error: ${e.response} ${e.status}`);else{const t=document.getElementById("configuration_iframe");t.contentWindow.postMessage(e.response,t.dataset.transfer)}},e.send(encodeSettings(t))}function sendSignupData(){const t=new XMLHttpRequest;t.open("POST",ajaxurl),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4===t.readyState)if(t.status>=400)console.log(`callback error: ${t.response} ${t.status}`);else{const e=document.getElementById("configuration_iframe"),n=JSON.stringify({trustpilot_signup_data:t.response});e.contentWindow.postMessage(n,e.dataset.transfer)}},t.send(encodeSettings({action:"get_signup_data"}))}function updateplugin(){const t=new XMLHttpRequest;t.open("POST",ajaxurl),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(encodeSettings({action:"update_trustpilot_plugin"}))}function TrustBoxPreviewMode(t){const e=JSON.parse(t),n=document.getElementById("trustpilot-trustbox-preview");e.TrustBoxPreviewMode.enable?n.hidden=!1:n.hidden=!0}function reloadSettings(){const t=new XMLHttpRequest;t.open("POST",ajaxurl),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4===t.readyState)if(t.status>=400)console.log(`callback error: ${t.response} ${t.status}`);else{const e=document.getElementById("configuration_iframe");e.contentWindow.postMessage(t.response,e.dataset.transfer)}},t.send(encodeSettings({action:"reload_trustpilot_settings"}))}function submitSettings(t){let e={action:"handle_save_changes"};"updatePageUrls"===t.type?e.pageUrls=encodeURIComponent(JSON.stringify(t.pageUrls)):"newTrustBox"===t.type?e.customTrustBoxes=encodeURIComponent(JSON.stringify(t)):(e.settings=encodeURIComponent(JSON.stringify(t.settings)),document.getElementById("trustbox_preview_frame").dataset.settings=btoa(e.settings));const n=new XMLHttpRequest;n.open("POST",ajaxurl),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(encodeSettings(e))}function requestCategoryInfo(){const t=new XMLHttpRequest;t.open("POST",ajaxurl),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4===t.readyState&&(t.status>=400?console.log(`callback error: ${t.response} ${t.status}`):window.postMessage(JSON.stringify({categoryProductsData:t.response,basis:"plugin"}),window.origin))},t.send(encodeSettings({action:"get_category_product_info"}))}function updateIframeSize(t){const e=document.getElementById("configuration_iframe");e&&(e.height=t.window.height+"px")}function sendSettings(){const t=document.getElementById("configuration_iframe"),e=t.dataset,n=JSON.parse(atob(e.settings));if(n.trustbox||(n.trustbox={}),n.trustbox.pageUrls=JSON.parse(atob(e.pageUrls)),n.pluginVersion=e.pluginVersion,n.source=e.source,n.version=e.version,n.basis="plugin",n.productIdentificationOptions=JSON.parse(e.productIdentificationOptions),n.isFromMarketplace=e.isFromMarketplace,n.configurationScopeTree=JSON.parse(atob(e.configurationScopeTree)),n.pluginStatus=JSON.parse(atob(e.pluginStatus)),n.mode=e.mode,n.trustbox.trustboxes&&e.sku)for(trustbox of n.trustbox.trustboxes)trustbox.sku=e.sku;if(n.trustbox.trustboxes&&e.name)for(trustbox of n.trustbox.trustboxes)trustbox.name=e.name;t.contentWindow.postMessage(JSON.stringify(n),checkProtocol(e.transfer))}function checkProtocol(t){if(t.startsWith("//")){return window.location.protocol+t}return t}function sendPastOrdersInfo(t){const e=document.getElementById("configuration_iframe"),n=e.dataset;void 0===t&&(t=n.pastOrders),e.contentWindow.postMessage(t,checkProtocol(n.transfer))}window.addEventListener("message",this.receiveSettings);
//# sourceMappingURL=integrationScript.min.js.map
